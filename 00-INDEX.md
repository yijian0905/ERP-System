# E-Invoice Multi-Industry Tax Configuration System

## 文檔索引與架構說明

> **Version**: 2.0  
> **Last Updated**: December 2025  
> **Purpose**: 為 AI Agent 提供完整的多行業 E-Invoice 稅務配置系統技術規範

---

## 文檔架構總覽

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    E-INVOICE MULTI-INDUSTRY SYSTEM                          │
│                         文檔模組架構圖                                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│  00-INDEX.md    │      │  01-INDUSTRY    │      │  02-TAX-RATES   │
│  主索引文檔     │─────▶│  -CONFIG.md     │─────▶│  .md            │
│  (本文檔)       │      │  商業領域配置   │      │  稅率規範模組   │
└─────────────────┘      └────────┬────────┘      └────────┬────────┘
                                  │                        │
                                  │ 聯動                   │ 聯動
                                  ▼                        ▼
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│  03-CLASSIFI-   │      │  04-MSIC-CODES  │      │  05-TAX-ENGINE  │
│  CATION.md      │◀────▶│  .md            │◀────▶│  .md            │
│  分類代碼模組   │      │  MSIC代碼模組   │      │  稅率自動化引擎 │
└─────────────────┘      └─────────────────┘      └─────────────────┘
         │                        │                        │
         └────────────────────────┼────────────────────────┘
                                  │
                                  ▼
                         ┌─────────────────┐
                         │  E-Invoice.md   │
                         │  核心API整合    │
                         │  (原始文檔)     │
                         └─────────────────┘
```

---

## 文檔模組說明

### 📋 00-INDEX.md (本文檔)
**用途**: 主索引，說明整體架構和文檔關係  
**聯動關係**: 連結所有子模組

---

### 🏭 01-INDUSTRY-CONFIG.md
**用途**: 商業領域配置模組  
**功能**:
- 用戶初始化時選擇公司所屬領域
- 定義各領域適用的功能集
- 配置領域特定的 UI 顯示邏輯
- 設定預設稅率和分類代碼

**聯動關係**:
- → 02-TAX-RATES.md: 根據領域載入適用稅率
- → 03-CLASSIFICATION.md: 根據領域篩選分類代碼
- → 04-MSIC-CODES.md: 根據領域建議 MSIC 代碼

---

### 💰 02-TAX-RATES.md
**用途**: 馬來西亞 SST 稅率完整規範  
**功能**:
- Sales Tax (5% / 10%) 規則
- Service Tax (6% / 8%) 規則
- Tourism Tax 規則
- 免稅項目清單
- 豁免規則

**聯動關係**:
- ← 01-INDUSTRY-CONFIG.md: 接收領域配置
- → 05-TAX-ENGINE.md: 提供稅率數據給自動化引擎
- → 03-CLASSIFICATION.md: 稅率與分類代碼的對應關係

---

### 🏷️ 03-CLASSIFICATION.md
**用途**: LHDN 45 個分類代碼完整說明  
**功能**:
- 完整 45 個分類代碼列表
- 各代碼適用場景
- 與稅率的對應關係
- 與商業領域的關聯

**聯動關係**:
- ← 01-INDUSTRY-CONFIG.md: 接收領域配置
- ← 02-TAX-RATES.md: 接收稅率對應
- → E-Invoice.md: 提供 e-Invoice 提交所需的分類代碼

---

### 🏢 04-MSIC-CODES.md
**用途**: 馬來西亞標準工業分類代碼  
**功能**:
- MSIC 5 位數代碼結構說明
- 主要行業分類
- 與商業領域的對應
- 常見行業 MSIC 代碼快速參考

**聯動關係**:
- ← 01-INDUSTRY-CONFIG.md: 接收領域配置
- → E-Invoice.md: 提供供應商 MSIC 代碼

---

### ⚙️ 05-TAX-ENGINE.md
**用途**: 稅率自動化計算引擎  
**功能**:
- 根據商品/服務自動判斷稅率
- 根據領域配置套用預設值
- 用戶覆寫權限設計
- 稅率驗證邏輯

**聯動關係**:
- ← 01-INDUSTRY-CONFIG.md: 接收領域配置
- ← 02-TAX-RATES.md: 接收稅率規則
- ← 03-CLASSIFICATION.md: 接收分類代碼
- → E-Invoice.md: 輸出最終稅率到發票

---

### 📄 E-Invoice.md (原始核心文檔)
**用途**: MyInvois API 整合核心規範  
**功能**:
- API 端點參考
- 55 個必填欄位
- 文檔類型
- Sandbox 測試環境
- 實作檢查清單

**聯動關係**:
- ← 所有模組: 接收配置後的數據
- → MyInvois API: 最終 e-Invoice 提交

---

## 資料流向圖

```
用戶初始化流程:
═══════════════

    ┌─────────────────────────────────────────────────────────────┐
    │                     用戶首次安裝/訂閱                        │
    └─────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────┐
    │ Step 1: 選擇公司所屬商業領域                                 │
    │         (01-INDUSTRY-CONFIG.md)                             │
    │                                                             │
    │   □ 零售業 (Retail)                                         │
    │   □ 餐飲業 (F&B)                                            │
    │   □ 專業服務 (Professional Services)                        │
    │   □ 製造業 (Manufacturing)                                  │
    │   □ 建築業 (Construction)                                   │
    │   □ 批發業 (Wholesale)                                      │
    │   □ 電子商務 (E-Commerce)                                   │
    │   □ 旅遊酒店 (Tourism & Hospitality)                        │
    │   □ 醫療保健 (Healthcare)                                   │
    │   □ 教育 (Education)                                        │
    │   □ 其他 (Others)                                           │
    └─────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────┐
    │ Step 2: 系統自動載入配置                                     │
    │                                                             │
    │   ✓ 適用稅率 (02-TAX-RATES.md)                              │
    │   ✓ 相關分類代碼 (03-CLASSIFICATION.md)                     │
    │   ✓ 建議 MSIC 代碼 (04-MSIC-CODES.md)                       │
    │   ✓ 稅率計算規則 (05-TAX-ENGINE.md)                         │
    └─────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────┐
    │ Step 3: 用戶確認/調整設定                                    │
    │                                                             │
    │   ⚙️ 可修改預設稅率                                         │
    │   ⚙️ 可新增/移除分類代碼                                    │
    │   ⚙️ 可調整 MSIC 代碼                                       │
    │   ⚙️ 可設定特殊稅率規則                                     │
    └─────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────┐
    │ Step 4: 儲存配置，系統就緒                                   │
    └─────────────────────────────────────────────────────────────┘


發票建立流程:
═══════════════

    ┌─────────────────────────────────────────────────────────────┐
    │                     建立新發票                               │
    └─────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────┐
    │ 新增商品/服務項目                                            │
    │                                                             │
    │   商品名稱: [___________________]                           │
    │   分類代碼: [自動建議 / 手動選擇]                           │
    │   單價:     [___________]                                   │
    │   數量:     [___________]                                   │
    └─────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────┐
    │ 稅率自動化引擎 (05-TAX-ENGINE.md)                           │
    │                                                             │
    │   1. 檢查分類代碼 → 對應稅率規則                            │
    │   2. 檢查商業領域 → 適用稅率                                │
    │   3. 檢查豁免條件 → 是否免稅                                │
    │   4. 計算稅額                                               │
    └─────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────┐
    │ 顯示建議稅率 (用戶可覆寫)                                    │
    │                                                             │
    │   稅種: [Service Tax ▼]                                     │
    │   稅率: [8% ▼] ← 系統建議，可修改                           │
    │   稅額: RM XX.XX                                            │
    │                                                             │
    │   ⚠️ 修改預設稅率將記錄於審計日誌                           │
    └─────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────┐
    │ 提交至 MyInvois (E-Invoice.md)                              │
    └─────────────────────────────────────────────────────────────┘
```

---

## 關鍵設計原則

### 1. 模組化設計
每個文檔獨立維護，可單獨更新而不影響其他模組。

### 2. 鬆耦合
模組間透過明確定義的介面溝通，降低相依性。

### 3. 用戶覆寫權限
系統自動配置稅率，但保留用戶修改權限，並記錄所有變更。

### 4. 跨領域支援
系統設計不限於特定行業，透過領域配置模組支援任何商業類型。

### 5. 合規優先
所有稅率規則以 LHDN/RMCD 官方規範為準，確保法規遵循。

---

## 快速導航

| 需求 | 參考文檔 |
|------|----------|
| 設定公司商業領域 | [01-INDUSTRY-CONFIG.md](./01-INDUSTRY-CONFIG.md) |
| 查詢適用稅率 | [02-TAX-RATES.md](./02-TAX-RATES.md) |
| 選擇分類代碼 | [03-CLASSIFICATION.md](./03-CLASSIFICATION.md) |
| 查詢 MSIC 代碼 | [04-MSIC-CODES.md](./04-MSIC-CODES.md) |
| 稅率自動計算邏輯 | [05-TAX-ENGINE.md](./05-TAX-ENGINE.md) |
| API 整合 | [E-Invoice.md](./E-Invoice.md) |

---

## 版本歷史

| 版本 | 日期 | 變更說明 |
|------|------|----------|
| 2.0 | 2025-12 | 新增多行業稅務配置系統 |
| 1.0 | 2025-12 | 初始 E-Invoice API 規範 |

---

*本索引文檔為 AI Agent 提供系統架構總覽，請根據具體需求查閱相關子模組。*
